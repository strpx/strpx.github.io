# ğŸ”¥ Firebase ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã‚¬ã‚¤ãƒ‰

è¤‡æ•°ãƒ‡ãƒã‚¤ã‚¹ã§ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å…±æœ‰ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã®Firebaseå®Ÿè£…ã‚¬ã‚¤ãƒ‰

## ğŸ¯ ãªãœFirebaseã‹ï¼Ÿ

### ãƒ¡ãƒªãƒƒãƒˆ
âœ… ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸï¼ˆ100msä»¥ä¸‹ï¼‰  
âœ… ç„¡æ–™ãƒ—ãƒ©ãƒ³ï¼ˆSparkï¼‰ã§ååˆ†  
âœ… ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒç°¡å˜  
âœ… ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«  
âœ… èªè¨¼æ©Ÿèƒ½ã‚‚åˆ©ç”¨å¯èƒ½  
âœ… GitHubPagesã¨ç›¸æ€§ãŒè‰¯ã„  

### ç„¡æ–™ãƒ—ãƒ©ãƒ³ã®åˆ¶é™
- åŒæ™‚æ¥ç¶š: 100
- ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸: 1GB
- ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰: 10GB/æœˆ
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ DB: 100,000 åŒæ™‚æ¥ç¶š

â†’ å°ã€œä¸­è¦æ¨¡ã®ã‚¤ãƒ™ãƒ³ãƒˆã«ã¯ååˆ†ï¼

## ğŸš€ å®Ÿè£…æ‰‹é †

### ã‚¹ãƒ†ãƒƒãƒ—1: Firebaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ

1. https://console.firebase.google.com/ ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ã€Œãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿½åŠ ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåå…¥åŠ›ï¼ˆä¾‹: seat-lottery-appï¼‰
4. Googleã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ç„¡åŠ¹ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
5. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆå®Œäº†

### ã‚¹ãƒ†ãƒƒãƒ—2: Realtime Databaseæœ‰åŠ¹åŒ–

1. å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã€ŒRealtime Databaseã€ã‚’ã‚¯ãƒªãƒƒã‚¯
2. ã€Œãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½œæˆã€
3. ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³é¸æŠï¼ˆasia-southeast1æ¨å¥¨ï¼‰
4. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«é¸æŠ:
   - **ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰**: é–‹ç™ºæ™‚
   - **ãƒ­ãƒƒã‚¯ãƒ¢ãƒ¼ãƒ‰**: æœ¬ç•ªæ™‚ï¼ˆå¾Œã§ãƒ«ãƒ¼ãƒ«è¨­å®šï¼‰

### ã‚¹ãƒ†ãƒƒãƒ—3: Web ã‚¢ãƒ—ãƒªè¿½åŠ 

1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®šï¼ˆæ­¯è»Šã‚¢ã‚¤ã‚³ãƒ³ï¼‰
2. ã€Œã‚¢ãƒ—ãƒªã‚’è¿½åŠ ã€â†’ Web ã‚¢ã‚¤ã‚³ãƒ³
3. ã‚¢ãƒ—ãƒªåå…¥åŠ›
4. Firebase Hostingè¨­å®šï¼ˆã‚¹ã‚­ãƒƒãƒ—å¯ï¼‰
5. è¨­å®šæƒ…å ±ã‚’ã‚³ãƒ”ãƒ¼

```javascript
const firebaseConfig = {
  apiKey: "AIzaSy...",
  authDomain: "your-app.firebaseapp.com",
  databaseURL: "https://your-app.firebaseio.com",
  projectId: "your-app",
  storageBucket: "your-app.appspot.com",
  messagingSenderId: "123456789",
  appId: "1:123456789:web:abcdef"
};
```

### ã‚¹ãƒ†ãƒƒãƒ—4: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«è¨­å®š

```json
{
  "rules": {
    "sessions": {
      "$session_id": {
        ".read": true,
        ".write": true
      }
    },
    "seat_assignments": {
      "$session_id": {
        ".read": true,
        ".write": true,
        ".indexOn": ["session_id", "seat_number"]
      }
    }
  }
}
```

## ğŸ’» ã‚³ãƒ¼ãƒ‰å®Ÿè£…

### index-firebase.htmlï¼ˆç°¡æ˜“ç‰ˆï¼‰

```html
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>å¸­ãã˜å¼•ãã‚¢ãƒ—ãƒª - Firebaseç‰ˆ</title>
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <style>
        /* ... æ—¢å­˜ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼ ... */
    </style>
</head>
<body>
    <!-- ... æ—¢å­˜ã®HTMLã‚’ã‚³ãƒ”ãƒ¼ ... -->

    <script>
        // Firebaseè¨­å®š
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "your-app.firebaseapp.com",
            databaseURL: "https://your-app.firebaseio.com",
            projectId: "your-app"
        };

        // FirebaseåˆæœŸåŒ–
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let currentSession = null;
        let sessionListener = null;

        // ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆ
        async function createSession() {
            const sessionName = document.getElementById('sessionName').value.trim();
            const totalSeats = parseInt(document.getElementById('totalSeats').value);

            if (!sessionName || totalSeats < 2 || totalSeats > 100) {
                alert('å…¥åŠ›ã‚’ç¢ºèªã—ã¦ãã ã•ã„');
                return;
            }

            const sessionId = 'sess_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            const session = {
                session_id: sessionId,
                session_name: sessionName,
                total_seats: totalSeats,
                status: 'active',
                created_at: firebase.database.ServerValue.TIMESTAMP
            };

            try {
                await db.ref('sessions/' + sessionId).set(session);
                currentSession = { ...session, session_id: sessionId };
                showDrawScreen();
            } catch (error) {
                console.error('Error:', error);
                alert('ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        // ã‚»ãƒƒã‚·ãƒ§ãƒ³å‚åŠ 
        async function joinSession() {
            const sessionId = document.getElementById('sessionId').value.trim();
            if (!sessionId) return;

            try {
                const snapshot = await db.ref('sessions/' + sessionId).once('value');
                if (snapshot.exists()) {
                    currentSession = { ...snapshot.val(), session_id: sessionId };
                    showDrawScreen();
                } else {
                    alert('ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
            }
        }

        // ãã˜å¼•ãå®Ÿè¡Œ
        async function drawSeat() {
            const participantName = document.getElementById('participantName').value.trim();
            if (!participantName) {
                alert('åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            document.getElementById('drawButton').disabled = true;
            showDrawAnimation();

            try {
                // ä½¿ç”¨æ¸ˆã¿å¸­ç•ªå·ã‚’å–å¾—
                const assignmentsSnapshot = await db.ref('seat_assignments/' + currentSession.session_id).once('value');
                const usedSeats = new Set();
                
                if (assignmentsSnapshot.exists()) {
                    assignmentsSnapshot.forEach(child => {
                        usedSeats.add(child.val().seat_number);
                    });
                }

                // åˆ©ç”¨å¯èƒ½ãªå¸­ã‚’è¨ˆç®—
                const availableSeats = [];
                for (let i = 1; i <= currentSession.total_seats; i++) {
                    if (!usedSeats.has(i)) {
                        availableSeats.push(i);
                    }
                }

                if (availableSeats.length === 0) {
                    alert('ã™ã¹ã¦ã®å¸­ãŒåŸ‹ã¾ã£ã¦ã„ã¾ã™');
                    hideDrawAnimation();
                    document.getElementById('drawButton').disabled = false;
                    return;
                }

                // ãƒ©ãƒ³ãƒ€ãƒ é¸æŠ
                const selectedSeat = availableSeats[Math.floor(Math.random() * availableSeats.length)];

                // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆ2ç§’ï¼‰
                let counter = 0;
                const interval = setInterval(() => {
                    document.getElementById('rouletteNumber').textContent = 
                        Math.floor(Math.random() * currentSession.total_seats) + 1;
                    counter++;
                    if (counter >= 20) {
                        clearInterval(interval);
                        finalizeDraw(participantName, selectedSeat);
                    }
                }, 100);

            } catch (error) {
                console.error('Error:', error);
                alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
                hideDrawAnimation();
                document.getElementById('drawButton').disabled = false;
            }
        }

        // ãã˜å¼•ãç¢ºå®š
        async function finalizeDraw(participantName, seatNumber) {
            const assignmentId = 'assign_' + Date.now();
            const assignment = {
                participant_name: participantName,
                seat_number: seatNumber,
                session_id: currentSession.session_id,
                created_at: firebase.database.ServerValue.TIMESTAMP
            };

            try {
                await db.ref('seat_assignments/' + currentSession.session_id + '/' + assignmentId).set(assignment);
                hideDrawAnimation();
                showResult(participantName, seatNumber);
                document.getElementById('drawButton').disabled = false;
                document.getElementById('participantName').value = '';
            } catch (error) {
                console.error('Error:', error);
                alert('ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ çµæœç›£è¦–
        function startRealtimeSync() {
            if (sessionListener) {
                sessionListener.off();
            }

            sessionListener = db.ref('seat_assignments/' + currentSession.session_id);
            sessionListener.on('value', (snapshot) => {
                const results = [];
                if (snapshot.exists()) {
                    snapshot.forEach(child => {
                        results.push(child.val());
                    });
                }

                // è¡¨ç¤ºæ›´æ–°
                displayResults(results);
            });
        }

        // çµæœè¡¨ç¤º
        function displayResults(results) {
            const resultsList = document.getElementById('resultsList');
            
            if (results.length === 0) {
                resultsList.innerHTML = '<p class="empty-message">ã¾ã èª°ã‚‚ãã˜ã‚’å¼•ã„ã¦ã„ã¾ã›ã‚“</p>';
                return;
            }

            results.sort((a, b) => a.seat_number - b.seat_number);
            
            resultsList.innerHTML = results.map(item => `
                <div class="result-item">
                    <span class="result-item-name">${escapeHtml(item.participant_name)}</span>
                    <span class="result-item-seat">å¸­ ${item.seat_number}</span>
                </div>
            `).join('');
        }

        // ç”»é¢è¡¨ç¤º
        function showDrawScreen() {
            document.getElementById('setupScreen').classList.remove('active');
            document.getElementById('drawScreen').classList.add('active');
            document.getElementById('currentSessionName').textContent = currentSession.session_name;
            document.getElementById('currentSessionId').textContent = currentSession.session_id;
            document.getElementById('currentTotalSeats').textContent = currentSession.total_seats;
            startRealtimeSync();
        }

        // ãã®ä»–ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
        function showDrawAnimation() {
            document.getElementById('drawAnimation').classList.add('active');
            document.getElementById('resultCard').classList.remove('active');
        }

        function hideDrawAnimation() {
            document.getElementById('drawAnimation').classList.remove('active');
        }

        function showResult(name, seatNumber) {
            document.getElementById('resultName').textContent = name + ' ã•ã‚“';
            document.getElementById('resultSeatNumber').textContent = seatNumber;
            document.getElementById('resultCard').classList.add('active');
        }

        function copySessionId() {
            navigator.clipboard.writeText(currentSession.session_id).then(() => {
                alert('ã‚»ãƒƒã‚·ãƒ§ãƒ³IDã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼');
            }).catch(() => {
                prompt('ã‚»ãƒƒã‚·ãƒ§ãƒ³IDã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„:', currentSession.session_id);
            });
        }

        function backToSetup() {
            if (sessionListener) {
                sessionListener.off();
            }
            document.getElementById('drawScreen').classList.remove('active');
            document.getElementById('setupScreen').classList.add('active');
            currentSession = null;
        }

        function escapeHtml(text) {
            const map = {'&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;'};
            return text.replace(/[&<>"']/g, m => map[m]);
        }

        function generateId() {
            return 'sess_' + Math.random().toString(36).substring(2, 15);
        }
    </script>
</body>
</html>
```

## ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–

### ã‚ˆã‚Šå®‰å…¨ãªãƒ«ãƒ¼ãƒ«

```json
{
  "rules": {
    "sessions": {
      "$session_id": {
        ".read": true,
        ".write": "!data.exists() || data.child('status').val() === 'active'"
      }
    },
    "seat_assignments": {
      "$session_id": {
        "$assignment_id": {
          ".read": true,
          ".write": "!data.exists()",
          ".validate": "newData.hasChildren(['participant_name', 'seat_number', 'session_id'])"
        }
      }
    }
  }
}
```

## ğŸ“Š ã‚³ã‚¹ãƒˆè©¦ç®—

### ç„¡æ–™ãƒ—ãƒ©ãƒ³ï¼ˆSparkï¼‰ã§ã®åˆ¶é™

**1ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆ50äººå‚åŠ ï¼‰ã®å ´åˆ:**
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ›¸ãè¾¼ã¿: ç´„50å›
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¥ç¶š: æœ€å¤§50åŒæ™‚
- ãƒ‡ãƒ¼ã‚¿è»¢é€: ç´„1MB

**æœˆé–“æƒ³å®š:**
- 20ã‚¤ãƒ™ãƒ³ãƒˆå®Ÿæ–½
- ç·ãƒ‡ãƒ¼ã‚¿è»¢é€: 20MB
- â†’ ç„¡æ–™ãƒ—ãƒ©ãƒ³ã§ååˆ†ï¼âœ…

## ğŸ¯ ã¾ã¨ã‚

| é …ç›® | LocalStorageç‰ˆ | Firebaseç‰ˆ |
|------|---------------|-----------|
| è¤‡æ•°ãƒ‡ãƒã‚¤ã‚¹å…±æœ‰ | âŒ | âœ… |
| ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸ | åŒä¸€ãƒ–ãƒ©ã‚¦ã‚¶ã®ã¿ | å…¨ãƒ‡ãƒã‚¤ã‚¹ |
| ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— | ä¸è¦ | å¿…è¦ï¼ˆ30åˆ†ï¼‰ |
| ã‚³ã‚¹ãƒˆ | ç„¡æ–™ | ç„¡æ–™ï¼ˆåˆ¶é™å†…ï¼‰ |
| ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ | âœ… | âŒ |
| ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£ | ä½ | é«˜ |

**æ¨å¥¨:**
- å¯¾é¢ã‚¤ãƒ™ãƒ³ãƒˆ â†’ LocalStorageç‰ˆ
- ãƒªãƒ¢ãƒ¼ãƒˆå‚åŠ  â†’ Firebaseç‰ˆ
- ä¸¡æ–¹æä¾› â†’ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé¸æŠ

---

**æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—**: Firebaseç‰ˆã‚’ `index-firebase.html` ã¨ã—ã¦å®Ÿè£…ã—ã€README.mdã«é¸æŠè‚¢ã¨ã—ã¦è¨˜è¼‰
